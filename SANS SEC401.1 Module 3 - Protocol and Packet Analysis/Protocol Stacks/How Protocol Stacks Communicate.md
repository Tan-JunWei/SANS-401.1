
The basic principle of stack-based communication is that data from one layer of the stack on the transmitting computer can be understood only by the corresponding receiving layer of the receiving computer. 

Each layer of the transmitting system is only aware of the requirements that must be fulfilled to communicate with the corresponding layer of the receiving system. Each layer is **not aware of the contents of data generated by the other layers of the stack, and in fact, do not need to know the specifics of the other layers to allow communication to succeed**. This "layer independence" has great benefit, but also bring about [[How Protocol Stacks Communicate#Potential security implications|potential security implications]].

#### The concept of stack-layer to stack-layer communication
![[OSI 7 Layers stack-layer to stack-layer communication.png]]

It isn't actually each stack-layer sending individual messages. For example, Host A forms a communication to transmit across the physical medium, after the totality of each of the layers of its stack having done their specific jobs ([[How Protocol Stacks Communicate#Note Encapsulation and Decapsulation|'moving down a stack']]). 

The communication is then sent across a physical medium and is received by Host B. Host B processes the communication ([[How Protocol Stacks Communicate#Note Encapsulation and Decapsulation|'moving up a stack']]) until the data of the communication itself can be processed by the application interacting at the **Application Layer**.

However, since the layers don't actually communicate directly with each other, how would the **Presentation Layer on Host B** 'know' that data was **compressed** by the **Presentation Layer on Host A**?

#### Use of headers
This problem is solved via the use of headers.

>[!abstract] What are headers?
>
>Headers are blocks of data that describe work that was done at a corresponding layer.
>
>**Use of headers: An example**
>In the example of compression being done by the Presentation Layer of Host A, the Presentation Layer will prepend a data structure to the compressed data indicating that the data is being compressed. 
>
>When the communicated data is finally processed by the Presentation Layer of Host B, the Presentation Layer header is read (and subsequently discarded as it is not longer necessary), allowing the layer to understand that the data was compressed. Host B's Presentation Layer can then decompress the data.

As each layer could have specific protocols that perform specific functions, the headers themselves are often referred to as 'protocol headers'. 

#### Potential security implications

>[!bug] Example: IP address spoofing
>
>In IP address spoofing, an attacker forges the source IP address found in the IP header (Layer 3 - Network Layer), to make a communication appear to originate from an IP address that it isn't.
>
>Considering that many security controls are predicated upon which IP addresses are involved in a communication, the ability to fool a computer into thinking a communication is coming from a specific computer, simply **based on the IP address being claimed**, is of significant risk.
>
>Such an attack is trivial to perform since the Network Layer on either computer **does not take into consideration any data from any other layer** below or above in the stack, and **has no reason not to believe that IP address** being represented in the header.

##### Pros and Cons
Layer independence makes it easier and faster to write and maintain networking software, but a security system should consider the entirety of information from all layers in the stack. 

However, layer-based security is not designed equally, and any given security technology may consider only specific layers of the stack. 

#### Note: Encapsulation and Decapsulation
>[!note] 'Moving down/up a stack'
>
>The process of moving down a stack, with each layer doing work, leveraging the addition of a header to describe said work is often described with the term '**encapsulation**'.
>
>The converse is true; The process of moving up a stack, with each layer doing work, combined with the reading and removing of headers is often described with the term '**decapsulation**'.